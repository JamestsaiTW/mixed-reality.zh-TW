---
title: 空間對應設計
description: 若要有效使用 HoloLens 內的空間對應, 必須仔細考慮許多因素。
author: cre8ivepark
ms.author: dongpark
ms.date: 03/21/2018
ms.topic: article
keywords: Windows Mixed Reality, 設計, 空間對應, HoloLens, 表面重建, 網格
ms.openlocfilehash: 02e64727f9a23bea28e018d7c4e5a8b89c152447
ms.sourcegitcommit: 60f73ca23023c17c1da833c83d2a02f4dcc4d17b
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/17/2019
ms.locfileid: "69566005"
---
# <a name="spatial-mapping-design"></a>空間對應設計

若要有效使用 HoloLens 內的空間對應, 必須仔細考慮許多因素。

## <a name="device-support"></a>裝置支援

<table>
    <colgroup>
    <col width="33%" />
    <col width="33%" />
    <col width="33%" />
    </colgroup>
    <tr>
        <td><strong>功能</strong></td>
        <td><a href="hololens-hardware-details.md"><strong>HoloLens</strong></a></td>
        <td><a href="immersive-headset-hardware-details.md"><strong>沉浸式頭戴裝置</strong></a></td>
    </tr>
     <tr>
        <td>空間對應設計</td>
        <td>✔️</td>
        <td>❌</td>
    </tr>
</table>

## <a name="why-is-spatial-mapping-important"></a>為什麼空間對應很重要？

空間對應可以將物件放在實際的表面上。 這有助於錨定使用者世界中的物件, 並利用真實世界的深度提示。根據其他全息影像和真實世界物件 Occluding 您的全息影像, 有助於說服使用者這些全息影像實際上在其空間中。 在空間中浮動或與使用者移動的全息影像, 將不會覺得真實。 可能的話, 請將專案放在緩和之下。

在放置或移動全息影像時將表面視覺化 (使用簡單的投影方格)。 這可協助使用者知道他們可以在哪裡放置其全息影像, 並在使用者嘗試放置全息全像的位置尚未進行對應的情況下顯示。 如果使用者的角度過多, 您可以將「佈告欄專案」導向至使用者。

## <a name="what-influences-spatial-mapping-quality"></a>什麼會影響空間對應品質？

[這裡](environment-considerations-for-hololens.md)詳述的幾個因素可能會影響這些錯誤的頻率和嚴重性。  不過, 您應該設計應用程式, 讓使用者即使在空間對應資料中出現錯誤, 也能夠達到其目標。

## <a name="the-environment-scanning-experience"></a>環境掃描體驗

每個使用空間對應的應用程式都應該考慮提供「掃描經驗」;應用程式用來引導使用者掃描應用程式正常運作所需表面的進程。

![掃描的範例](images/sr-mixedworld-140429-8pm-00068-1000px.png)<br>
*掃描的範例*

此掃描體驗的本質可能會因為每個應用程式的需求而有很大的差異, 但兩個主要原則應該會引導其設計。

首先,**與使用者進行明確通訊是主要的考慮**。 使用者應該一律知道是否符合應用程式的需求。 如果不符合這些條件, 使用者應該立即清楚知道這是什麼, 而且應該很快就會採取適當的動作。

其次,**應用程式應該嘗試在效率和可靠性之間取得平衡**。 當可以**可靠地**執行此動作時, 應用程式應該會自動分析空間對應資料以節省使用者時間。 當您無法可靠地執行此動作時, 應用程式應該改為讓使用者快速提供所需的其他資訊給應用程式。

為了協助設計正確的掃描經驗, 請考慮下列何種可能適用于您的應用程式:

* **沒有掃描經驗**
   * 應用程式可以順利運作, 而不需要任何引導式掃描體驗;它將瞭解在自然使用者移動期間觀察到的表面。
   * 例如, 可讓使用者在使用全像攝影的表面上繪製的應用程式, 只需要知道使用者目前可以看見的表面。
   * 如果環境是使用者已花很多時間使用 HoloLens 的情況, 則可能已完全掃描該環境。
   * 但請記住, 空間對應所使用的相機只能看到使用者前方的 3.1 m, 因此空間對應將不會知道任何更遠的表面, 除非使用者已從較近的距離觀察到它們。
   * 因此, 使用者瞭解已掃描的表面, 應用程式應該為此效果提供視覺化的意見反應, 例如, 將虛擬陰影轉型為掃描的表面, 可以協助使用者在這些表面上放置全息影像。
   * 在此情況下, 空間介面觀察者的周框應將每個框架更新為主體鎖定的[空間座標系統](coordinate-systems.md), 使其遵循使用者。

* **尋找適當的位置**
   * 應用程式可以設計成在具有特定需求的位置中使用。
   * 例如, 應用程式可能需要使用者附近的空白區域, 才能安全地練習全像 kung-fu。
   * 應用程式應該將任何特定的需求傳遞給使用者, 並以清楚的視覺效果回饋來加強。
   * 在此範例中, 應用程式應該將所需空白區域的範圍視覺化, 並以視覺化方式反白顯示此區域內任何不想要的物件。
   * 在此情況下, 空間表面觀察器的周框磁片區應該在選擇的位置中使用世界鎖定的[空間座標系統](coordinate-systems.md)。

* **尋找適當的表面設定**
   * 應用程式可能需要特定的介面設定, 例如兩個大型、平面、相反的牆, 以建立非全像的鏡像大廳。
   * 在這種情況下, 應用程式必須分析空間對應所提供的表面, 以偵測適當的表面, 並將使用者導向至這些介面。
   * 如果應用程式的表面分析不完全可靠, 使用者應該有一個 fallback 選項。 例如, 如果應用程式不正確地將門口識別為平面, 則使用者需要一個簡單的方法來更正此錯誤。

* **掃描環境的一部分**
   * 應用程式可能只想要依使用者的指示來捕捉部分的環境。
   * 例如, 應用程式會掃描部分房間, 讓使用者可以針對想要銷售的傢俱張貼全像的分類廣告。
   * 在此情況下, 應用程式應該在使用者于其掃描期間觀察到的區域內, 捕獲空間對應資料。

* **掃描整個聊天室**
   * 應用程式可能需要掃描目前房間中的所有介面, 包括使用者背後的表面。
   * 例如, 遊戲可能會將使用者 Gulliver 的角色, siege 從所有方向接近數百個小型 Lilliputians。
   * 在這種情況下, 應用程式必須判斷目前的房間中有多少表面已經過掃描, 並引導使用者的注視填滿明顯的間隙。
   * 此程式的關鍵在於提供視覺化意見反應, 讓使用者清楚指出尚未掃描的表面。 例如, 應用程式可以使用以[距離為基礎的霧化](https://msdn.microsoft.com/library/windows/desktop/bb173401%28v=vs.85%29.aspx), 以視覺方式反白顯示空間對應介面未涵蓋的區域。

* **製作環境的初始快照集**
   * 應用程式可能會想要在取得初始「快照集」之後忽略環境中的所有變更。
   * 這可能適合用來避免使用者建立的資料中斷, 並與環境的初始狀態緊密結合。
   * 在此情況下, 當掃描完成時, 應用程式應該複製其初始狀態的空間對應資料。
   * 如果環境仍然正確地 pixels occluded 了全息影像, 應用程式應該會繼續接收空間對應資料的更新。
   * 對於空間對應資料的持續更新也允許視覺化已發生的任何變更, 並向使用者說明環境先前和目前狀態之間的差異。

* **採取使用者起始的環境快照**
   * 應用程式可能只想要在使用者指示時回應環境變更。
   * 例如, 使用者可以在不同的時間捕捉其姿勢, 藉以建立多個 friend 的 3D ' statues '。

* **允許使用者變更環境**
   * 應用程式可以設計成即時回應使用者環境中所做的任何變更。
   * 例如, 使用者繪製揭開可能會觸發「場景變更」, 以在另一端進行全像播放。

* **引導使用者避免空間對應資料中的錯誤**
   * 應用程式在掃描其環境時, 可能會想要為使用者提供指引。
   * 這可協助使用者避免[空間對應資料中](spatial-mapping-design.md#what-influences-spatial-mapping-quality)特定類型的錯誤, 例如, 離開 sunlit 視窗或鏡像。

另一個要注意的詳細資料是空間對應資料的「範圍」不是無限的。 雖然空間對應確實會建立大量的永久資料庫, 但它只會將資料提供給使用者周圍具有有限大小的「反升」應用程式。 因此, 如果您從長 corridor 的開端開始, 並從一開始就夠遠, 那麼最後的空間表面就會消失。 您可以藉由在應用程式中的介面從可用空間對應資料消失之後, 將這些表面快取, 藉此減輕此問題。

## <a name="mesh-processing"></a>網格處理

這可能有助於偵測介面中常見的錯誤類型, 並視需要篩選、移除或修改空間對應資料。

請記住, 空間對應資料的目的是要盡可能忠實呈現到真實世界的表面, 因此您套用的任何處理風險會從「真」進一步改變您的表面。

以下是一些您可能會覺得有用的不同網格處理類型範例:

* **孔填滿**
   * 如果無法掃描呈現深色資料的小型物件, 則會在周圍表面留下一個洞。
   * 孔會影響遮蔽: 您可以在被視為不透明的真實世界表面中, 看到「到」一個洞處的全息影像。
   * 孔會影響 raycasts: 如果您使用 raycasts 來協助使用者與介面互動, 則這些光線可能不會想要通過洞。 其中一個緩和措施是使用多個 raycasts 的組合, 涵蓋適當大小的區域。 這可讓您篩選 ' 極端 ' 的結果, 如此一來, 即使某個 raycast 通過小洞, 匯總結果仍會是有效的。 不過, 請注意, 這種方法是以計算成本來表示。
   * 孔會影響物理衝突: 物理模擬所控制的物件可能會透過樓層中的洞下降, 並會遺失。
   * 您可以在 surface 網格中以演算法方式填滿這類洞。 不過, 您必須調整您的演算法, 讓「真實漏洞」 (例如 windows 和門口) 不會填滿。 很難以可靠地區分「真實漏洞」與「虛數孔」, 因此您必須試驗不同的啟發學習法, 例如「大小」和「界限圖形」。

* **Hallucination 移除**
   * 反射、明亮的燈和移動物件可能會使小型延遲的「hallucinations」浮動在空中。
   * Hallucinations 會影響遮蔽: Hallucinations 可能會顯示為在和 occluding 其他全息影像之前移動的深色形狀。
   * Hallucinations 會影響 raycasts: 如果您使用 raycasts 協助使用者與表面互動, 這些光線可能會叫用 hallucination 而不是其背後的表面。 如同使用漏洞, 其中一個緩和措施是使用許多 raycasts, 而不是單一 raycast, 但同樣地, 這會產生計算成本。
   * Hallucinations 會影響物理衝突: 由物理模擬控制的物件可能會卡在 hallucination 中, 而且無法在看似清楚的空間區域間移動。
   * 您可以從 surface 網格篩選這類 hallucinations。 不過, 就像使用洞一樣, 您必須調整您的演算法, 如此一來, 就不會移除像是燈泡和門控點的實際小型物件。

* **平穩**
   * 空間對應可能會傳回看似粗略或「雜訊」的表面, 相較于其真實世界的對應專案。
   * 平滑度會影響物理衝突: 如果地面是粗略的, 實際模擬的高爾夫球球可能不會以直線平滑地在其上向前復原。
   * 平滑度會影響轉譯: 如果介面是直接視覺化的, 則粗略的表面法線會影響其外觀, 並干擾「整潔」外觀。 使用著色器中用來呈現介面的適當光源和材質, 可以減輕這種情況。
   * 可以在表面網格中平滑粗糙度。 不過, 這可能會使表面遠離對應的真實世界表面。 維護鄰近的對應對於產生正確的全像投影遮蔽, 以及讓使用者能夠與全像攝影表面達成精確且可預測的互動, 是很重要的。
   * 如果只需要修飾的變更, 可能就足以平滑頂點法線, 而不會變更頂點位置。

* **平面尋找**
   * 應用程式可能會想要在空間對應所提供的表面上執行許多形式的分析。
   * 一個簡單的範例是「平面尋找」;識別表面的界限、主要區域。
   * 平面區域可用來做為全像攝影的工作介面, 也就是可由應用程式自動放置全像攝影內容的區域。
   * 平面區域可以限制使用者介面, 以引導使用者與最符合其需求的表面進行互動。
   * 平面區域可在真實世界中用來做為全像, 對功能物件 (例如 LCD 畫面、表格或白板) 進行全像投影。
   * 平面區域可以定義播放區域, 形成 videogame 層級的基礎。
   * 平面區域可以協助虛擬代理程式流覽真實世界, 方法是識別真實人員可能會進行的樓層。

## <a name="prototyping-and-debugging"></a>原型設計和調試

### <a name="useful-tools"></a>有用的工具
* [HoloLens 模擬器](using-the-hololens-emulator.md)可用來使用空間對應來開發應用程式, 而不需要存取實體 HoloLens。 它可讓您在實際環境中模擬 HoloLens 上的即時會話, 其中包含您的應用程式通常會使用的所有資料, 包括 HoloLens 動作、空間座標系統和空間對應網格。 這可用來提供可靠且可重複的輸入, 這在偵測問題及評估程式碼變更時很有用。
* 若要重現案例, 請從即時 HoloLens 透過網路捕獲空間對應資料, 然後將它儲存到磁片, 然後在後續的調試階段中重複使用它。
* [Windows 裝置入口網站 3d view](using-the-windows-device-portal.md#3d-view)提供了一種方式, 可讓您查看目前可透過空間對應系統取得的所有空間表面。 這可為應用程式內的空間表面進行比較,例如, 您可以輕鬆地分辨是否有任何空間表面遺失或顯示在錯誤的位置。

### <a name="general-prototyping-guidance"></a>一般原型指引
* 由於空間對應資料中的[錯誤](spatial-mapping-design.md#what-influences-spatial-mapping-quality)可能會對使用者的體驗造成強烈影響, 因此建議您在各種不同的環境中測試您的應用程式。
* 千萬不要在相同位置 (例如您的辦公桌) 中永遠進行測試。 請務必在不同位置、圖形、大小和材質的各種表面上進行測試。
* 同樣地, 雖然綜合或記錄的資料可用於進行調試, 但不太依賴相同的幾個測試案例。 這可能會延遲找出更多測試會稍早發現的重要問題。
* 最好是使用實際 (而且在理想的指導) 使用者來執行測試, 因為他們可能無法使用 HoloLens 或您的應用程式, 其方式與您的做法完全相同。 事實上, 這可能會讓您感到驚訝, 人們的行為、知識和假設有多容易!

## <a name="see-also"></a>另請參閱
* [空間位置掃描視覺效果](room-scan-visualization.md)
* [空間音效設計](spatial-sound-design.md)
* [Unity 中的持續性](persistence-in-unity.md)
